Оптимизация для разных интервалов lastactive:
Нижняя граница до которой оптимизировать не надо. Для тех кто ниже принимаем модель "="
60 - оптимально
от 60 до 100 - сомнительный интервал
от 100 до 140 тоже плохенький но лучше
от 140 до 190 последний сомнительный, лучше предыдущего
от 190 все хорошо

! ПОПРОБОВАТЬ ВАРИАНТ ТАРГЕТА
yhat = (X[f'{target}(0)'] - y) / X[f'{target}(0)']
yhat[X[f'{target}(0)'] == 0] = 0
и тот что у умного
raw['target'] = raw.groupby('cfips')['microbusiness_density'].shift(-1) разность текущего и предыдущего
raw['target'] = raw['target'] / raw['microbusiness_density'] - 1

от 50 до 100 lastactive=param=15   max_active = 5730;
error 2.182730 -0.025767     0.000440



# Сделать отдельные модели по штатам и создать ранг полезности предсказания теста одного штата по модели другого штата
# Разделить cfips на группы по штатам и населению

# Сделать отдельные модели по группам цфипс разделенным по населению и другим признакам
# Проверить оптимизируемость и применимость модели без лагов, кроме лаг1 в другой модели

# Сделать модель предсказывающую решение какой из моделей верное на основе ласт правильности предыдущих
# моделей штата и ластактиве
# Как альтернатива предыдущему сделать линейную модель из решений 2-х моделей. А можно после этого
# сделать предыдущее решение

# ОШИБКА - после создания гибридов в new_cfips не было сглаживания вновб созданных гибридов -
# поэтому вероятно если сгладить гибриды то оптимизация new_cfips и ластактиве может быть другой


# НЕ РАБОТАЕТ Создать блек листы:
# НЕ РАБОТАЕТ  -по результатам предыдущих месяцев предсказания
# НЕ РАБОТАЕТ -по суммарному отклонению за все предыдущие месяцы
# НЕ РАБОТАЕТ -по качеству предсказания отдельных моделей за предыдущие месяцы
# НЕ РАБОТАЕТ -по абсолютной величине плотности микробинеса
# НЕ РАБОТАЕТ -по суммарному изменению отношения микробизнеса к активе в течении месяцев